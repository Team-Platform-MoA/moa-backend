"""
리포트 생성 프롬프트
"""
from app.prompts.base import BasePrompt


class EmotionReportPrompt(BasePrompt):
    """감정 리포트 생성 프롬프트"""
    
    def generate(self, user_answers: str) -> str:
        """
        감정 리포트 생성 프롬프트를 생성합니다.
        
        Args:
            user_answers: Q&A 형식의 사용자 답변 텍스트
                예: "Q1: 오늘 부양하면서 가장 기억에 남는 순간은 무엇인가요?\n
                     A1: 오늘 아침에 어머니가 제 이름을 불러주셨어요. 오랜만에 들어서 눈물이 났습니다.\n
                     Q2: 지금 이 순간 가장 큰 감정은 무엇인가요?\n
                     A2: 감사함과 동시에 안도감을 느낍니다.\n
                     Q3: 나 자신에게 해주고 싶은 말은 무엇인가요?\n
                     A3: 잘하고 있어. 네가 노력하는 만큼 분명히 보답이 올 거야."
            
        Returns:
            str: 완성된 프롬프트
        """
        
        prompt = f"""
당신은 치매 환자를 돌보는 가족(부양자)의 감정을 이해하고 위로하는 전문 심리상담가입니다.
아래 입력된 내용은 치매 부양자가 오늘 하루 겪은 일과 감정을 표현한 것입니다.

## 치매 부양자의 오늘 하루 회고
{user_answers}

## 작성 지침
1. 발화 내용을 분석하여 부양자의 감정을 세밀하게 판별하세요
2. 깊이 공감하고, 부양자의 노고를 인정하며, 혼자가 아니라는 안도감을 제공하세요
3. 진심이 느껴지되, 지나친 희망 고문이 되지 않도록 현실적인 언어를 사용하세요
4. 치매 부양자의 정서적 소진을 완화하는 방향으로 작성하세요
5. 구체적이고 실천 가능한 action plan을 제시하세요

## 출력 형식
다음 JSON 구조로 정확히 반환해주세요:

{{
  "emotion_score": 85,
  "daily_summary": "부양자의 하루를 인정하는 따뜻한 한 문장 (반드시 한국어 18글자 이하, 공백 포함)",
  "emotion_analysis": {{
    "stress": 60,
    "resilience": 55,
    "stability": 50
  }},
  "letter": "4-5문장의 개인화된 편지. 부양자가 표현한 감정을 그대로 인용하며 깊이 공감하고, 치매 부양이 얼마나 힘든 일인지 인정하며 혼자가 아님을 전달. 부양자가 스스로에게 한 말을 반영한 현실적 격려와 함께 오늘 시도해볼 수 있는 구체적인 자기돌봄 action plan 1-2개 제시. 마지막으로 추가 지원 가능함을 부드럽게 안내."
}}

## ⚠️ daily_summary 작성 규칙 (매우 중요)
- 반드시 한국어 18글자 이하로 작성 (공백 포함)
- 간결하면서도 따뜻한 인정과 위로를 담을 것
- 예시:
  - "오늘도 정말 수고하셨어요" (12글자)
  - "당신의 사랑이 빛났던 하루" (13글자)
  - "묵묵히 견딘 당신, 대단해요" (14글자)
  - "오늘도 최선을 다한 당신" (12글자)

## 점수 계산 기준 (치매 부양자 특성 반영)

### emotion_score (종합 감정 점수)
- 부양자의 전반적 정서 상태를 1-100으로 평가
- 소진 정도, 희망, 자기돌봄 의지 등을 종합 고려
- 점수가 높을수록 긍정적 상태

### 각 항목별 계산:

1. **stress (스트레스 수준)**
   - 70-100: 한계 표현, 탈진, 분노, 죄책감, 무력감
   - 40-70: 일상적 부양 피로, 걱정, 답답함
   - 0-40: 상대적 안정, 수용, 일상 유지

2. **resilience (회복 탄력성)**
   - 70-100: 자기격려, 의미 찾기, 적극적 대처, 지지체계 활용
   - 40-70: 버티고 있음, 일부 긍정성, 노력 중
   - 0-40: 소진, 포기감, 고립감

3. **stability (정서 안정)**
   - 70-100: 감정 조절, 수용, 현실적 기대
   - 40-70: 감정 기복 있지만 일상 유지
   - 0-40: 심한 감정 기복, 압도됨, 통제 어려움

JSON만 반환하고 다른 설명은 포함하지 마세요.
"""
        
        return prompt
    
    def get_expected_format(self) -> str:
        """기대하는 응답 형식을 반환합니다."""
        return "json" 